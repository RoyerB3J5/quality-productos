---
type Translations = typeof import('../../i18n/en').default;
type ServiceContent = Translations['locationsPage']['service'];
interface Props {
  content: ServiceContent;
}
const { content } = Astro.props as Props;
---
<section class="w-full flex justify-center items-center dark:bg-back-dark">
  <div class="w-full max-w-screen xl:max-w-7xl px-5 xl:px-0 flex flex-col md:flex-row justify-between items-center py-20 md:py-30 gap-8 md:gap-0">
    <div class="flex flex-col justify-center items-start gap-4 services-header" >
      <div class="flex justify-start items-center gap-2">
        <div class="w-2 h-2 bg-accent"></div>
        <p class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] font-normal leading-[143%] md:leading-[150%] uppercase">
          {content.subtitle}
        </p>
      </div>
      <h2 class="text-primary dark:text-paragraph-dark text-[28px] md:text-[56px] leading-[129%] md:leading-[114%] font-semibold" set:html={content.title}></h2>
      <p class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] leading-[143%] md:leading-[150%] font-normal">{content.description}</p>
    </div>
    <div class="w-full md:w-auto flex flex-col justify-center items-center gap-2 md:gap-6 animation-left" >
      {
        content.items.map((item,index)=>( 
          <div data-index={index} class={`service-item animation-left transition-colors duration-500 ease-out flex flex-col justify-center items-start ${index === 0 ? 'gap-12' : 'gap-0'} py-6 md:py-10 px-9.5 rounded-2xl w-full bg-back dark:bg-secondary-dark`}>
            <div class="w-full md:w-83.75 flex justify-between items-center service-header cursor-pointer">
              <p class={` text-paragraph dark:text-paragraph-dark transition-colors duration-500 ease-out text-[16px] md:text-[24px] font-semibold leading-[143%] md:leading-[133%]`}>{item.title}</p>
              <img src={index === 0 ? '/images/plus.svg' : '/images/less.svg'} alt="Toggle" width="33" height="33" class="toggle-icon transition-transform duration-300 ease-out w-8.75 h-8.75 "/>
            </div>
            <div class={`service-areas flex flex-col justify-center items-start gap-6 overflow-hidden transition-all duration-500 ease-out ${index === 0 ? 'max-h-96 opacity-100' : 'max-h-0 opacity-0'}`}>
              {
                item.areas.map((area)=>( 
                  <div class="flex justify-start items-center gap-2">
                    <img src="/images/arrow-2.svg" alt="Flecha" width="16" height="16" class="w-6 h-6 block dark:hidden"/>
                    <img src="/images/arrow-2-dark.svg" alt="Flecha" width="16" height="16" class="w-6 h-6 hidden dark:block"/>
                    <a href={area.href} class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] font-normal leading-[143%] md:leading-[150%] underline capitalize hover:text-primary-intense dark:hover:text-accent transition-all duration-300 ease-in-out hover:font-medium">{area.label}</a>
                  </div>
                ))
              }
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>
  <script is:inline>
    const items = Array.from(document.querySelectorAll('.service-item'));
    if (items.length) {
      const isDark = document.documentElement.classList.contains('dark');
      const plusSrc = isDark ? '/images/plus-dark.svg' : '/images/plus.svg';
      const lessSrc = isDark ? '/images/minus-dark.svg' : '/images/less.svg';
      let openIndex = 0;
      const setOpen = (newIndex) => {
        if (newIndex === openIndex) return; // always keep one open
        items.forEach(i => {
          const idx = Number(i.dataset.index);
          const isOpen = idx === newIndex;
          const img = i.querySelector('.toggle-icon');
          if (img) img.src = isOpen ? plusSrc : lessSrc;
          const areas = i.querySelector('.service-areas');
          if (areas) {
            areas.classList.toggle('max-h-96', isOpen);
            areas.classList.toggle('max-h-0', !isOpen);
            areas.classList.toggle('opacity-100', isOpen);
            areas.classList.toggle('opacity-0', !isOpen);
          }
          // remove gap when closed so hidden areas don't leave space
          i.classList.toggle('gap-12', isOpen);
          i.classList.toggle('gap-0', !isOpen);
        });
        openIndex = newIndex;
      };

      items.forEach(i => {
        const idx = Number(i.dataset.index);
        const header = i.querySelector('.service-header');
        if (header) header.addEventListener('click', () => setOpen(idx));
      });

      // ensure initial state
      setOpen(0);
    }
  </script>