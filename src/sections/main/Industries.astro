---
import Button from '../../components/Button.astro';

type Translations = typeof import('../../i18n/en').default;
type IndustriesContent = Translations['main']['industries'];
interface Props {
  content: IndustriesContent;
}
const { content } = Astro.props as Props;
---
<section class="w-full flex justify-center items-center dark:bg-back-dark">
  <div class="w-full max-w-screen xl:max-w-7xl px-5 xl:px-0 py-30 flex flex-col justify-center items-center gap-8 lg:gap-35.5">
    <div class="flex flex-col justify-center items-start gap-4 w-full services-header" >
      <div class="flex justify-start items-center gap-2">
        <div class="w-2 h-2 bg-accent"></div>
        <p class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] font-normal leading-[143%] md:leading-[150%] uppercase">
              {content.description}
        </p>
      </div>
      <h2 class="text-primary dark:text-paragraph-dark text-[28px] md:text-[56px] font-semibold leading-[129%] md:leading-[114%] max-w-180">
            {content.title}
      </h2>
      <p class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] leading-[143%] md:leading-[150%] " set:html={content.paragraph}></p>
      <Button
          text={content.button.label}
          textClass="text-white"
          href={content.button.href}
          target="_blank"
          extraBtnClass={`bg-accent hover:bg-accent/90 `}
        />
    </div>
    <div class="w-full flex flex-col justify-center items-center industries-list animation-zoom gap-6 md:gap-0" >
      {
        content.items.map((item,index)=>( 
          <a href={item.button.href} data-index={index} class={`cursor-pointer industries-item w-full flex justify-start items-center py-4 md:py-10 relative transition-all duration-300 ease-in-out ${index == 0 ? 'lg:bg-back dark:lg:bg-secondary-dark rounded-2xl lg:px-6 active' : ''}`}>
            <div class="w-full max-w-211.5 flex flex-col md:flex-row justify-between  items-start md:items-center gap-4 md:gap-0">
              <h3 class={`${index == 0 ? 'text-paragraph  lg:text-primary dark:text-accent' : 'text-paragraph dark:text-paragraph-dark'} transition-all duration-300 ease-in-out text-[20px] md:text-[32px] font-semibold leading-[140%] md:leading-[125%]`}>{item.title}</h3>
              <div class="flex flex-col justify-center items-start gap-4 max-w-102.75 industries-info">
                <p class="text-paragraph dark:text-paragraph-dark text-[14px] md:text-[16px] font-normal leading-[143%] md:leading-[150%]">{item.description}</p>
                <span class="hover:text-primary dark:hover:text-[#8E93C8] text-accent transition-all duration-300 ease-in-out text-[12px] font-semibold leading-[133%] underline uppercase cursor-pointer">{item.button.label}</span>
              </div>
            </div>
            
            <div class={`hidden lg:block aspect-square w-75.5 rounded-t-2xl absolute bottom-0 right-6 transition-all duration-300 ease-in-out box-border border-t-8 border-r-8 border-l-8 border-paragraph dark:border-paragraph-dark ${index == 0 ? 'opacity-100 translate-y-0 active' : 'opacity-0 translate-y-[8%]'}`} style="transform-style: preserve-3d;">
              <div class="relative w-full h-full overflow-hidden rounded-t-lg ">
                <img src={`/images/${item.image}.webp`} alt={item.title} width="302" height="302" decoding="async" loading="lazy" class="w-full h-full object-cover object-center absolute inset-0 "/>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</section>
<script is:inline>
    const list = document.querySelector('.industries-list');
    if (list) {
      const items = Array.from(list.querySelectorAll('.industries-item'));
      let activeIndex = 0; // Track current active item
      let listeners = []; // Store listener references
      
      const isDark = () => document.documentElement.classList.contains('dark');
      
      // Función para establecer cual item está activo
      const setActiveItem = (index) => {
        activeIndex = index;
        const dark = isDark();
        
        items.forEach(i => {
          const itemIndex = Number(i.dataset.index);
          const isActive = itemIndex === index;
          
          // Actualizar clases del item
          if (isActive) {
            i.classList.add('bg-back');
            i.classList.add('dark:bg-secondary-dark');
            i.classList.add('rounded-2xl');
            i.classList.add('lg:px-6');
            i.classList.add('active');
            i.classList.remove('lg:bg-transparent');
            i.classList.remove('dark:lg:bg-transparent');
          } else {
            i.classList.remove('bg-back');
            i.classList.remove('dark:bg-secondary-dark');
            i.classList.remove('rounded-2xl');
            i.classList.remove('lg:px-6');
            i.classList.remove('active');
            i.classList.add('lg:bg-transparent');
            i.classList.add('dark:lg:bg-transparent');
          }
          
          // Actualizar h3
          const h3 = i.querySelector('h3');
          if (h3) {
            if (isActive) {
              h3.classList.add('text-primary');
              h3.classList.add('dark:text-accent');
              h3.classList.add('lg:text-primary');
              h3.classList.add('dark:lg:text-accent');
              h3.classList.remove('text-paragraph');
              h3.classList.remove('dark:text-paragraph-dark');
            } else {
              h3.classList.remove('text-primary');
              h3.classList.remove('dark:text-accent');
              h3.classList.remove('lg:text-primary');
              h3.classList.remove('dark:lg:text-accent');
              h3.classList.add('text-paragraph');
              h3.classList.add('dark:text-paragraph-dark');
            }
          }
          
          // Actualizar decoración
          const deco = i.querySelector('.aspect-square');
          if (deco) {
            if (isActive) {
              deco.classList.add('translate-y-0');
              deco.classList.remove('translate-y-[8%]');
              deco.classList.add('opacity-100');
              deco.classList.remove('opacity-0');
            } else {
              deco.classList.remove('translate-y-0');
              deco.classList.add('translate-y-[8%]');
              deco.classList.remove('opacity-100');
              deco.classList.add('opacity-0');
            }
          }
        });
      };

      // Función para resetear a estilos básicos (mobile)
      const resetToBasicStyles = () => {
        items.forEach(i => {
          // Remover todas las clases especiales del item
          i.classList.remove('bg-back');
          i.classList.remove('dark:bg-secondary-dark');
          i.classList.remove('rounded-2xl');
          i.classList.remove('lg:px-6');
          i.classList.remove('active');
          i.classList.remove('lg:bg-transparent');
          i.classList.remove('dark:lg:bg-transparent');
          
          // Resetear h3 a estilo básico
          const h3 = i.querySelector('h3');
          if (h3) {
            h3.classList.remove('text-primary');
            h3.classList.remove('dark:text-accent');
            h3.classList.remove('lg:text-primary');
            h3.classList.remove('dark:lg:text-accent');
            h3.classList.add('text-paragraph');
            h3.classList.add('dark:text-paragraph-dark');
          }
          
          // Resetear decoración a invisible
          const deco = i.querySelector('.aspect-square');
          if (deco) {
            deco.classList.remove('translate-y-0');
            deco.classList.add('translate-y-[8%]');
            deco.classList.remove('opacity-100');
            deco.classList.add('opacity-0');
          }
        });
      };
      
      // Función para agregar los event listeners
      const addHoverListeners = () => {
        // Remover listeners previos
        listeners.forEach(({ element, handler }) => {
          element.removeEventListener('mouseenter', handler.enter);
          element.removeEventListener('mouseleave', handler.leave);
        });
        listeners = [];
        
        items.forEach(item => {
          const idx = Number(item.dataset.index);
          
          const enterHandler = () => setActiveItem(idx);
          const leaveHandler = (e) => {
            // Si el mouse se va para otro industri-item, no hacer nada
            const to = e.relatedTarget;
            if (to && to.closest && to.closest('.industries-item')) return;
            // Si no, volver al primer item
            setActiveItem(0);
          };
          
          item.addEventListener('mouseenter', enterHandler);
          item.addEventListener('mouseleave', leaveHandler);
          
          listeners.push({
            element: item,
            handler: { enter: enterHandler, leave: leaveHandler }
          });
        });
      };
      
      // Función para remover los event listeners
      const removeHoverListeners = () => {
        listeners.forEach(({ element, handler }) => {
          element.removeEventListener('mouseenter', handler.enter);
          element.removeEventListener('mouseleave', handler.leave);
        });
        listeners = [];
      };
      
      // Verificar y aplicar según el ancho de la ventana
      const checkAndApply = () => {
        if (window.innerWidth >= 1024) {
          addHoverListeners();
        } else {
          removeHoverListeners();
          // En mobile, resetear a estilos básicos sin efectos
          resetToBasicStyles();
        }
      };
      
      // Aplicar al cargar
      checkAndApply();
      
      // Escuchar cambios de tamaño de ventana
      window.addEventListener('resize', checkAndApply);
    }
  </script>