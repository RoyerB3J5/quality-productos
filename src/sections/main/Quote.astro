---
import Button from '../../components/Button.astro';

type Translations = typeof import('../../i18n/en').default;
type FormContent = Translations['main']['form'];
interface Props {
  content: FormContent;
}
const { content } = Astro.props as Props;
---
<section class="w-full flex justify-center items-center relative " >
  <img src="/images/back-form.webp" alt="Imagen de Fondo Quality Port" width="1500" height="1144" decoding="async" loading="lazy" class="absolute top-0 left-0 w-full h-full object-cover object-[50%_80%] inset-0 z-0"/>
  <div class="w-full h-full z-5 bg-black/40 absolute"></div>
  <div class="w-full max-w-screen xl:max-w-7xl px-5 xl:px-0 flex justify-between items-start gap-18.75 py-30 z-10 form-section relative " >
    <div class="w-[40%] flex flex-col justify-center items-start gap-4 move-content transform" >
      <div class="flex justify-start items-center gap-2" data-aos="fade-right">
        <div class="w-2 h-2 bg-white"></div>
        <p class="text-white text-[16px] font-normal leading-[150%] uppercase">
            {content.subtitle}
        </p>
      </div>
      <div class="flex flex-col justify-center items-start gap-10" data-aos="fade-right">
        <h2 class="text-white text-[56px] font-semibold leading-[114%]">{content.title}</h2>
        <p class="text-white text-[16px] font-normal leading-[150%]">{content.description}</p>
        <Button
              text={content.buttons[0].label}
              textClass={'text-paragraph'}
              href={content.buttons[0].href}
              target="_blank"
              extraBtnClass={'bg-accent hover:bg-accent/90'}
              iconName={content.buttons[0].icon}
            />
      </div>
    </div>
    <div class="w-[60%] aspect-737/860 h-auto rounded-2xl bg-primary-electric" data-aos="fade-left">
    </div>
  </div>
</section>

<script is:inline>
{
  const parent = document.querySelector('.form-section');
  const content = parent?.querySelector('.move-content');

  let maxTranslate = 0;
  let animationFrameId = null;
  let contentStartTop = 0;

  function calculateMaxTranslate() {
    if (!parent || !content) return;

    const parentHeight = parent.offsetHeight;
    const contentHeight = content.offsetHeight;

    const styles = getComputedStyle(parent);
    const paddingTop = parseFloat(styles.paddingTop);
    const paddingBottom = parseFloat(styles.paddingBottom);
    const verticalPadding = paddingTop + paddingBottom;

    // lÃ­mite inferior real
    maxTranslate = Math.max(
      0,
      parentHeight - verticalPadding - contentHeight
    );

    // ðŸ”¥ ESTE ES EL CAMBIO IMPORTANTE
    contentStartTop =
      content.getBoundingClientRect().top +
      (window.scrollY || document.documentElement.scrollTop);
  }

  function updateTransform() {
    if (!parent || !content) return;

    const scrollTop =
      window.scrollY || document.documentElement.scrollTop;

    let translateAmount = 0;

    if (scrollTop >= contentStartTop) {
      const scrollProgress = scrollTop - contentStartTop;
      translateAmount = Math.min(scrollProgress, maxTranslate);
    }

    // ðŸ”¥ agregar / quitar mt-4
    if (translateAmount > 0) {
      content.classList.add('mt-4');
    } else {
      content.classList.remove('mt-4');
    }

    content.style.transform =
      `translateY(${translateAmount}px)`;
  }


  function onScroll() {
    if (animationFrameId) {
      cancelAnimationFrame(animationFrameId);
    }
    animationFrameId = requestAnimationFrame(updateTransform);
  }

  calculateMaxTranslate();
  updateTransform();

  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', () => {
    calculateMaxTranslate();
    updateTransform();
  });
}
</script>
